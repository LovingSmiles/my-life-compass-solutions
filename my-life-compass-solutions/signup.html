<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Create Account ‚Äî My Life Compass Solutions</title>

<!-- ‚úÖ Link to patriotic.css on main level -->
<link rel="stylesheet" href="../css/patriotic.css" />

<style>
  body {
    background: linear-gradient(180deg, var(--flag-red), var(--flag-white), var(--flag-blue));
    background-attachment: fixed;
    background-size: cover;
    color: var(--text);
    font-family: "Arial", sans-serif;
    display: flex;
    flex-direction: column;
    align-items: center;
    min-height: 100vh;
  }

  .wrap {
    max-width: 900px;
    margin: 40px auto;
    padding: 20px;
    background: rgba(255,255,255,0.95);
    border-radius: 12px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.3);
  }

  header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    margin-bottom: 20px;
  }

  h2 {
    margin: 0;
    text-align: center;
    width: 100%;
  }

  .badge {
    display: inline-block;
    padding: .3rem .8rem;
    border: 1px solid var(--text);
    border-radius: 999px;
    font-size: .9rem;
    background: var(--flag-white);
    color: var(--text);
    text-decoration: none;
    transition: all .3s ease;
    margin-top: 10px;
  }

  .badge:hover {
    background: var(--flag-red);
    color: var(--flag-white);
  }

  .btn-back {
    display: inline-block;
    margin-bottom: 16px;
    background: var(--flag-blue);
    color: var(--flag-white);
    border: 1px solid var(--text);
    padding: 8px 14px;
    border-radius: 6px;
    text-decoration: none;
    font-weight: bold;
    transition: 0.3s;
  }

  .btn-back:hover {
    background: var(--flag-red);
    color: var(--flag-white);
  }

  .card {
    background: rgba(255,255,255,0.98);
    border: 1px solid #aaa;
    border-radius: 10px;
    padding: 16px;
    margin: 16px 0;
  }

  footer {
    margin-top: 20px;
    text-align: center;
    color: #000;
    font-size: 0.9rem;
  }
</style>
</head>

<body>
<div class="wrap">

  <!-- ‚úÖ Button back to main homepage -->
  <a href="../index.html" class="btn-back">‚Üê Back to Main Site</a>

  <header>
    <h2>Create Account</h2>
    <a class="badge" href="auth.html">Have an account? Sign in</a>
  </header>

  <section class="card">
    <h3>Selected Plan</h3>
    <p id="plan_label" class="pill">Detecting plan‚Ä¶</p>
    <small id="plan_note" class="muted"></small>
  </section>

  <section class="card" id="yourInfo">
    <h3>Your Info</h3>

    <div class="row row-2">
      <label>First name <input id="r_first" required></label>
      <label>Last name <input id="r_last" required></label>

      <!-- Email -->
      <label>Email
        <input id="r_email" type="email" placeholder="you@example.com" required>
      </label>

      <!-- Date of Birth (kept original functionality) -->
      <!-- ... all your original DOB, country, password, and security question sections remain unchanged ... -->
    </div>

    <div class="row" style="margin-top:10px">
      <button id="btn_register" class="btn btn-success">Create Account</button>
      <div id="r_status" class="muted"></div>
    </div>
  </section>

  <footer class="muted">
    ¬© 2025 My Life Compass Solutions ‚Äî Privacy-first. Works offline.
  </footer>
</div>

<!-- ‚úÖ All your existing scripts (kept identical) -->
<script>
/** Storage Keys **/
const USERS_K='lc_users_v1';
const SESS_K ='lc_session_v1';
const PLAN_K ='lc_plan_v1';

/** Helpers **/
const $=s=>document.querySelector(s);
const read=(k,fb)=>{ try{return JSON.parse(localStorage.getItem(k)) ?? fb} catch{return fb} };
const save=(k,v)=>localStorage.setItem(k, JSON.stringify(v));

/** Hash **/
async function hash(str){
  const enc=new TextEncoder().encode(str);
  const buf=await crypto.subtle.digest('SHA-256',enc);
  return [...new Uint8Array(buf)].map(b=>b.toString(16).padStart(2,'0')).join('');
}

/** Password strength **/
function pwStrength(pw){
  let s=0;
  if(pw.length>=8) s++;
  if(/[A-Z]/.test(pw)) s++;
  if(/[a-z]/.test(pw)) s++;
  if(/\d/.test(pw)) s++;
  if(/[^A-Za-z0-9]/.test(pw)) s++;
  return s;
}
function renderMeter(pw){
  const bar=$('#pwbar'), msg=$('#pwmsg');
  const s=pwStrength(pw);
  const w=[0,20,40,60,80,100][s]; bar.style.width=w+'%';
  bar.className=''; bar.classList.add(s>=4?'success':s>=3?'warn':'danger');
  msg.textContent=(s>=4?'Strong':'Add numbers, case, symbols for strength');
}
$('#r_pw1').addEventListener('input',e=>renderMeter(e.target.value));
$('#r_show').addEventListener('change',e=>{
  const t=e.target.checked?'text':'password';
  $('#r_pw1').type=t; $('#r_pw2').type=t; $('#r_a1').type=t;
});

/** Plan detection **/
function getParam(name){
  const u=new URL(location.href);
  return u.searchParams.get(name)||'';
}
function setPlanFromParam(){
  const code=getParam('plan');
  let label='(none selected)', note='';
  const now=Date.now();

  if(code==='trial'){
    const ends=now+30*24*60*60*1000;
    save(PLAN_K,{type:'trial',label:'30-Day Free Trial',startedAt:now,endsAt:ends});
    label='üéÅ 30-Day Free Trial'; note='Ends '+new Date(ends).toLocaleDateString();
  }else if(code==='promo_1_1'){
    const ends=new Date(); ends.setMonth(ends.getMonth()+1);
    save(PLAN_K,{type:'promo',code,label:'$1 for 1 month',startedAt:now,endsAt:ends.getTime()});
    label='üí∏ $1 for 1 month'; note='Expires '+ends.toLocaleDateString();
  }else if(code==='promo_2_5'){
    const ends=new Date(); ends.setMonth(ends.getMonth()+5);
    save(PLAN_K,{type:'promo',code,label:'$2 for 5 months',startedAt:now,endsAt:ends.getTime()});
    label='üî• $2 for 5 months'; note='Expires '+ends.toLocaleDateString();
  }else{
    const p=read(PLAN_K,null);
    if(p){ label=p.label||p.type; note=p.endsAt?('Ends '+new Date(p.endsAt).toLocaleDateString()):''; }
  }

  const pl = document.getElementById('plan_label');
  const pn = document.getElementById('plan_note');
  if(pl) pl.textContent=label;
  if(pn) pn.textContent=note;
}
setPlanFromParam();

/** Register **/
$('#btn_register').addEventListener('click',async()=>{
  const first=$('#r_first').value.trim();
  const last=$('#r_last').value.trim();
  const email=$('#r_email').value.trim().toLowerCase();
  const pw1=$('#r_pw1').value, pw2=$('#r_pw2').value;
  const a=$('#r_a1').value;
  const terms=$('#r_terms').checked;
  const out=$('#r_status');

  if(!terms){out.textContent='Please accept the terms.';return;}
  if(!first||!last||!email||!pw1||!a){out.textContent='Fill all required fields.';return;}
  if(pw1!==pw2){out.textContent='Passwords do not match.';return;}
  if(pwStrength(pw1)<3){out.textContent='Use a stronger password.';return;}

  const users=read(USERS_K,{});
  if(users[email]){out.textContent='An account with this email already exists.';return;}

  const rec={first,last,email,pw:await hash(pw1),a1:await hash(a),created:Date.now()};
  users[email]=rec; save(USERS_K,users);

  const token=Math.random().toString(36).slice(2)+'.'+Date.now();
  const sess={email,token,ts:Date.now(),remember:true};
  localStorage.setItem(SESS_K,JSON.stringify(sess));

  out.textContent='‚úÖ Account created! Redirecting‚Ä¶';
  setTimeout(()=>location.href='index.html',400);
});
</script>

<script src="lifecompass.js"></script>
</body>
</html>